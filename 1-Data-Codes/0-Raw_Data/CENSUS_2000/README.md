# Computation of Employment Allocations and the Matrices of Migration Flows

This file explains how to calculate labor allocation by state an sector for the years 1999-2007 and how to compute the labor movements across these states and sectors for all those years.

## Employment allocation in each state and sector for 2000

We first compute the employment level for each state and sector in the year 2000. Steps to follow:

1. Download the employment and unemployment levels for each state in the year 2000 that the Census Bureau published based on the 2000 Decennial Census. The file is entitled "Table 1. Employment Status of the Population 16 Years Old and Over in Households for the United States, States, Counties, and for Puerto Rico: 2000." Download the revised Excel xls file. The file can be accessed [here](https://www.census.gov/data/tables/2000/dec/phc-t-28.html). We changed the name of the downloaded excel file to "employment_2000.xls".
2. The previous does not include distribution of workers by sectors. To gather such disaggregation we  use the 5 % sample PUMS files of the 2000 Census. These files are available [here](https://www.census.gov/data/datasets/2000/dec/microdata.html). One needs to open the folder "All additional files for the PUMS 5-Percent Dataset" and download the file "PUMS5.txt" within each state folder. There is no need to change the name of the downloaded text files.  Also, note that the variable dictionary for the census data is located in the same link and is entitled "5%_PUMS_record_layout.xls".  Note that each observation is compressed in a single line to save space. Therefore, the variables of interest have to be created using start and stop character positions.  For more information regarding the NAICS industry codes used in the census sample files, see p. 547 in [here](https://www.census.gov/prod/cen2000/doc/pums.pdf); the most updated version of the previous NAICS table can be found in [here](https://www2.census.gov/programs-surveys/cps/methodology/Industry Codes.pdf). Whenever available we use NAICS codes instead of Census Industry codes, and then recode them to final sectors.
3. In the census 2000 sample we only keep observations type "P" (persons) with age in between 25 and 65, and that are either employed or unemployed. Unemployment plus non-participation will be considered an extra sector: sector 0. NAICS sectors are recoded into final sectors of interest. We apply a proportionality rule with respect to the population employment and unemployment levels by state to obtain the labor allocation vector for each state and sector for 2000, $L_{2000}$. 

## Matrix of migration flows between sector and US states

We compute mobility matrices, $\mu^{nj,ik}_{t}$, for each origin state $n$, origin sector $j$, destination state $i$, and destination sector $k$, between year $t$ and $t+1$. 

The American Community Survey (ACS) Public Use Microdata Sample (PUMS) files provide details of workers' current employment status, sector, and state. It also asks the state in which respondents lived the year prior. However, this survey does not provide information regarding people's employment status and sector in the previous year. Therefore, this is only one of two data sources used. 

The second one is the Current Population Survey (CPS), which provides details of people's employment status, industry sector and state for each month from 1999 to 2007. However, this survey does not provide information regarding movements across states. Thus, we combine both the ACS and the CPS surveys to compute the labor transitions across states and sectors between every two years. Steps to follow:

1. The ACS PUMS csv files can be downloaded from the FTP server in [here](https://www.census.gov/programs-surveys/acs/microdata/access.html). Within the FTP server open the folders for the years 2000-2007 and download the files titled "csv_p{state}.zip". The survey's variable dictionary can be accessed through this [link](https://www2.census.gov/programs-surveys/acs/tech_docs/pums/data_dict/PUMSDataDict06.pdf) and the questionnaire through this [link](https://www2.census.gov/programs-surveys/acs/methodology/questionnaires/2020/quest20.pdf). There is no need to change the name of the downloaded csv files after decompressing the zip files.
2. We only keep observations with age in between 25 and 65, and that are either employed, unemployed or not in the labor force. Unemployment plus not in the labor force will be considered an extra sector: sector 0. We convert NAICS sectors into the final sectors of our paper. The current sector, current state, and previous year state are used to compute partial transition matrices with state of origin and destination and destination sector (there is no information about the sector of origin in the ACS). Following CDP, we refer to the values in these matrices as "y" values. These values are in levels and sum up to the sample, not yet the population. 
3. The CPS PUMS files can be downloaded [here](https://www.census.gov/data/datasets/time-series/demo/cps/cps-basic.2000.html); specifically, access each year (1999-2007) tab and download the DOS/Windows files for each month. Once decompressed, .dat or .cps files will be generated. Save each of these files with the same name (add a "_" at the end) as .txt. The survey's variable dictionary can be found in the same link for each year; in this case, the dictionary is important since it changed during the sample period and affected some of the variables of interest. Note that each observation is compressed in a single line of numbers to save space; therefore, variables of interest have to be created using start and stop character positions as the code does. This survey asks about employment status and sector in each month for respondents who reside in the same state throughtout the period of the survey.
4. The CPS surveys households in a 4-8-4 format; that is, interviews the household for 4 consecutive months, gives them an 8 month break and interviews them again for 4 consecutive months. Also, a new household can start the 4-8-4 sequence any month of the year. Since the CPS data comes in a monthly frequency and we are interested in workers' movements across time we have to match households and individuals across time. Each household ID is a concatenation of 4 variables (see code). However, this ID suffers a simplification in May-2004, difficulting automatic matches around that period. The necessary adjustment is detailed in the new dictionary and implemented in the code; basically, the new household ID is the previous one with some specific digits taken out. Persons within a household do not have a unique ID, therefore, one is created for them using the household ID and the person's age and gender.
5. We only keep observations with age in between 25 and 65, and that are either employed or unemployed. Again, unemployment plus not in labor force will be considered sector 0. CPS uses Census industry codes instead of NAICS, so, a different recoding is applied to convert them to the final sectors of interest. Also, the Census industry codes were updated in 2003 and changed positions in the variable dictionary. For more information regarding the Census industry codes changes see [link](https://www.bls.gov/cps/cpsoccind.htm); the old and new codes can be accessed  [here](https://www.nlsinfo.org/sites/nlsinfo.org/files/attachments/12124/NLSY97 1990 Census I and O codes.pdf) and in [here](https://www2.census.gov/programs-surveys/cps/methodology/Industry Codes.pdf).
6. We match CPS observations (individuals) across time using the interview number. Each of the first 4 monthly interviews are 12 months apart from the final 4 interviews. That is why worker movements' information is gathered using the following interview matching system: (1,5), (2,6), (3,7) and (4,8). The latter is equivalent to match each month in one year to the respective one in the following year. These matching between years, together with each person's information about past and current state and sector make it possible to compute changes in the labor allocation across time. These values are referred to as "x" (following Table IV in CDP, 2019). The CPS survey does not account for movements across states and that is why we still need the ACS's "y" values. We follow CDP's  assumption that interstates movements (i to j) across sectors follow the same pattern that intrastate movements in state j across sectors. We then apply proportionality to the "x" values to sum up to "y" values, which do not incur in assumptions and are available for interstate movements. In the few cases where the "x" column contains a vector of zeros, we replace the "x" values by the respective national averages. Similarly, if that substitution renders the same column of zeros a 1 is introduced in the origin=destination state-sector space to avoid losing information in the "y" value. This process results in "x adjusted" values and these cover the four aspects of the mobility matrices: origin and destination state and origin and destination sector. These values are in levels. We divide them by the rowsum of the matrix (flows go from rows to columns) to present the mobility matrices as shares of each initial state-sector.
7. Any zero value in a mobility matrix diagonal is changed into the minimum non-zero diagonal value and then the mobility matrix is re-normalized so that shares in the same row sum to 1. 

## Employment allocation in each state and sector for all years

#### For other countries

We compute the employment distribution by sector for each country and each year 1999-2007. It also applies proportionality to $L_{2000}$ (US states labor distribution) so that the matrix is consistent with WIOD. Steps:

1. Labor distribution by sector for each country during years 1999-2007 is obtained from WIOD Socio Economic Accounts (Released July 2014) in the following (link)[http://www.wiod.org/database/seas13]. The downloaded excel does not require a change of name. The variable of interest is EMP (number of persons engaged in thousands) and sectors are recoded into 1-14. Sector 0 (unemployed and out of labor force) is incorporated using WIOD-SEA's worker population and each country's labor force participation rate (see .lyx file). Year 2000 is taken as the base year and therefore all other years undergo a proportionality process so that population for each country maintains constant over time (zero growth, only redistribution between sectors). 

2. US labor distribution by sector and state, $L_{2000}$, undergoes a proportionality process (see .lyx file) so that the values are consistent with US-WIOD's information.  

#### For US States

We compute the employment distribution, for 1999, 2001-2007 using the employment distribution for 2000 and the mobility matrix for 1999. Steps:

1. Using the labor distribution for 2000, $L_{2000}$, and the mobility matrix, $\mu_{2000}$, for 2000-2007 it is possible to compute the labor of the following year using:  $$ L_{t}^{nj}=\sum_{i=1}^{N}\sum_{k=0}^{J}\mu_{t-1}^{ik,nj}\times L_{t-1}^{ik}$$ . We express this equation in vector form $L_{t} = t(\mu_{t-1})*L_{t-1}$. All subsequent labors distributions are computed in the same way. 
2.  $L_{1999}$ is computed using $L_{2000}$, and the 1999 mobility matrix in levels (and adjusted with proportionality so that it is consistent and sums to total $L$ in 2000).

US state labor distribution by sector and each other country labor distribution by sector are combined into a single matrix, $L_{yr}$. 