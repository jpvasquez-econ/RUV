------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction\2-Analysis-Codes\1-Log-Files\0-instrument.log
  log type:  text
 opened on:  20 Mar 2020, 18:52:11

. cd ..
C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction

. /*
> ***********************************************************************************************************************************************
> ***     THIS DO FILE DOES THE FOLLOWING:
> ***********************************************************************************************************************************************
> 
> 
> 1. IMPORTS WIOD DATA TO CREATE THE CHANGE IN IMPORTS FROM CHINA FOR THE US AND 
> OTHER ADVANCED ECONOMIES (Australia, Germany, Denmark, Spain, Finland, and Japan \\
> (New Zealand and Switzerland are not included in the WIOD).)
> 
> 2. ASSIGNS SAME CORRESPONDANCES AS IN CDP, SO THAT THE SECTORS ARE EQUIVALENT AS THOSE
> IN WIOD.
> 
> 3. COMPUTES THE SECTOR LEVEL CHANGES IN IMPORTS FROM CHINA TO OTHER COUNTRIES. 
> */
. 
. ********************** 
. ***  INPUT FILES   ***  
. **********************
. global wiod ""1-Data-Codes\2-Final_Data\WIOD_countries.dta""

. 
. ********************** 
. ***  OUTPUT FILES  ***  
. **********************
. global instrument ""2-Analysis-Codes\0-Processed-Data\0-instrument.dta""

. 
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***     1. IMPORTS WIOD DATA TO CREATE THE CHANGE IN IMPORTS FROM CHINA FOR THE US AND 
. ***             OTHER ADVANCED ECONOMIES (Australia, Germany, Denmark, Spain, Finland, and Japan 
. ***             (New Zealand and Switzerland are not included in the WIOD).) YEARS 2000 AND 2007        
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ** IN THE ROWS WE HAVE THE SELLERS. IN THE COLUMNS THE BUYERS
. use $wiod, clear

. keep if year==2000 | year==2007
(5320 observations deleted)

. keep year importer* sector value_CHN

. 
. *case of the US
. local reference "USA"

. local others "AUS DEU DNK ESP FIN JPN"

. *** other developed countries
. gen others=0

. local other `others'

. local n_countries= `: word count `other''

. display `n_countries'
6

. 
. foreach v of local other{
  2. replace others=1 if importer_c=="`v'"
  3. }
(28 real changes made)
(28 real changes made)
(28 real changes made)
(28 real changes made)
(28 real changes made)
(28 real changes made)

. *****
. ***** CHECKS
. *****
. distinct importer_c if other==1

                  |        Observations
                  |      total   distinct
------------------+----------------------
 importer_country |        168          6

. assert `r(ndistinct)'==`n_countries'

. *imports from China in AUS in 2000 in first manuf sector
. summ value if importer_c=="AUS" & sector==1 & year==2000

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   value_CHN |         1    235.8124           .   235.8124   235.8124

. local rounded=round(`r(mean)')

. assert `rounded'==236

. *imports from China in DNK in 2000 in seventh manuf sector
. summ value if importer_c=="DNK" & sector==7 & year==2000

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
   value_CHN |         1    18.46042           .   18.46042   18.46042

. local rounded=round(`r(mean)')

. assert `rounded'==18

. 
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***
. *** 3. COMPUTES THE SECTOR LEVEL CHANGES IN IMPORTS FROM CHINA TO OTHER COUNTRIES. 
. ***
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***     IMPORT GROWTH FROM CHINA 2007-2000
. ***********************************************************************************************************************************************
. **
. ** for others
. **
. preserve

. collapse (sum) value , by(other sector year)

. keep if other==1
(28 observations deleted)

. reshape wide value, i(other sector) j(year)
(note: j = 2000 2007)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       28   ->      14
Number of variables                   4   ->       4
j variable (2 values)              year   ->   (dropped)
xij variables:
                              value_CHN   ->   value_CHN2000 value_CHN2007
-----------------------------------------------------------------------------

. *** calculating import changes
. gen delta_M_others=value_CHN2007-value_CHN2000

. rename value_CHN2000 M_2000_others

. drop value*

. tempfile delta

. save `delta', replace
(note: file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000002.tmp not found)
file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000002.tmp saved

. restore

. **
. ** for US
. **
. keep if importer_c=="USA"
(1036 observations deleted)

. reshape wide value, i(importer_c sector) j(year)
(note: j = 2000 2007)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       28   ->      14
Number of variables                   6   ->       6
j variable (2 values)              year   ->   (dropped)
xij variables:
                              value_CHN   ->   value_CHN2000 value_CHN2007
-----------------------------------------------------------------------------

. *** calculating import changes
. gen delta_M_i=value_CHN2007-value_CHN2000

. rename value_CHN2000 M_2000

. keep sector delta_M_i importer* M_2000

. merge m:1 sector using `delta'

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                14  (_merge==3)
    -----------------------------------------

. assert _m==3

. drop _m

. 
. label var delta_M_others "$\Delta M$ Others"

. label var delta_M_i "$\Delta M$ i"

. keep importer* sector delta_M* M_2000*

. keep if sector<=12
(2 observations deleted)

. corr delta_M_i delta_M_others 
(obs=12)

             | delta_~i delta_~s
-------------+------------------
   delta_M_i |   1.0000
delta_M_ot~s |   0.9955   1.0000


. reg delta_M_i delta_M_others , r

Linear regression                                      Number of obs =      12
                                                       F(  1,    10) = 4089.51
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.9911
                                                       Root MSE      =  2899.5

--------------------------------------------------------------------------------
               |               Robust
     delta_M_i |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
delta_M_others |   1.431345   .0223825    63.95   0.000     1.381473    1.481216
         _cons |  -1624.513   962.4651    -1.69   0.122    -3769.019    519.9933
--------------------------------------------------------------------------------

. predict hat_delta_M_i , xb

. save $instrument, replace
file 2-Analysis-Codes\0-Processed-Data\0-instrument.dta saved

. log close
      name:  <unnamed>
       log:  C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction\2-Analysis-Codes\1-Log-Files\0-instrument.log
  log type:  text
 closed on:  20 Mar 2020, 18:52:16
------------------------------------------------------------------------------------------------------------------------------------------------------
