------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction\2-Analysis-Codes\1-Log-Files\1-exposures.log
  log type:  text
 opened on:  20 Mar 2020, 18:52:23

. cd ..
C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction

. /*
> ***********************************************************************************************************************************************
> ***     THIS DO FILE DOES THE FOLLOWING:
> ***********************************************************************************************************************************************
> 
> 1. CALCULATES THE VALUE ADDED EXPOSURE (ANALOGOUS TO ADH EXPOSURE) AND THE NET EXPORT (NX)
> EXPOSURE. (also other exposure measures)
> 
> */
. 
. ********************** 
. ***  INPUT FILES   ***  
. **********************
. global va_shares ""1-Data-Codes\2-Final_Data\labor_shares2000.csv""

. global bilat_trade ""1-Data-Codes\2-Final_Data\final_matrix_2000.csv""

. global instrument ""2-Analysis-Codes\0-Processed-Data\0-instrument.dta""

. local reference "USA"

. 
. ********************** 
. ***  OUTPUT FILES  ***  
. **********************
. global exposures ""2-Analysis-Codes\0-Processed-Data\exposures.dta""

. 
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***     1. VALUE ADDED EXPOSURE (ANALOGOUS TO ADH EXPOSURE) AND THE NET EXPORT (NX) EXPOSURE.
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***********************************************************************************************************************************************
. ***     VALUE ADDED AS SHARE OF SALES
. ***********************************************************************************************************************************************
. import delimited $va_shares, clear
(16 vars, 87 obs)

. keep if _n<=50
(37 observations deleted)

. drop year

. ds region, not
v3   v4   v5   v6   v7   v8   v9   v10  v11  v12  v13  v14  v15  v16

. *renaming variables
. local vari `r(varlist)'

. local i=1

. foreach v of local vari{
  2. rename `v' va_sh`i'
  3. local i=`i'+1
  4. }

. gen state=_n

. *keep manuf
. keep region va_sh*

. reshape long va_sh, i(region) j(sector)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->     700
Number of variables                  15   ->       3
j variable (14 values)                    ->   sector
xij variables:
              va_sh1 va_sh2 ... va_sh14   ->   va_sh
-----------------------------------------------------------------------------

. replace region=lower(region)
(700 real changes made)

. egen state=group(region)

. tempfile va_sh

. save `va_sh', replace
(note: file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000001.tmp not found)
file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000001.tmp saved

. 
. ***********************************************************************************************************************************************
. ***     SALES
. ***********************************************************************************************************************************************
. import delimited $bilat_trade, clear 
(89 vars, 1218 obs)

. replace sector=sector-100
(1218 real changes made)

. ds importer sector, not
alabama       georgia       maine         nevada        oregon        virginia      bra           fin           jpn           rus
alaska        hawaii        maryland      newhampshire  pennsylvania  washington    can           fra           kor           svk
arizona       idaho         massachuse~s  newjersey     rhodeisland   westvirginia  chn           gbr           ltu           svn
arkansas      illinois      michigan      newmexico     southcarol~a  wisconsin     cyp           grc           mex           swe
california    indiana       minnesota     newyork       southdakota   wyoming       cze           hun           nld           tur
colorado      iowa          mississippi   northcarol~a  tennessee     aus           deu           idn           pol           twn
connecticut   kansas        missouri      northdakota   texas         aut           dnk           ind           prt
delaware      kentucky      montana       ohio          utah          bel           esp           irl           rou
florida       louisiana     nebraska      oklahoma      vermont       bgr           est           ita           row

. *keep states
. local vari `r(varlist)'

. foreach v of local vari{
  2. if length("`v'")==3{
  3. drop `v'
  4. }
  5. }

. * sales 
. ds importer sector, not
alabama       colorado      hawaii        kansas        massachuse~s  montana       newmexico     oklahoma      southdakota   virginia
alaska        connecticut   idaho         kentucky      michigan      nebraska      newyork       oregon        tennessee     washington
arizona       delaware      illinois      louisiana     minnesota     nevada        northcarol~a  pennsylvania  texas         westvirginia
arkansas      florida       indiana       maine         mississippi   newhampshire  northdakota   rhodeisland   utah          wisconsin
california    georgia       iowa          maryland      missouri      newjersey     ohio          southcarol~a  vermont       wyoming

. local tradevars `r(varlist)'

. collapse (sum) `tradevars' , by(sector)

. *reshaping 
. local i=1

. quiet{

. ***********************************************************************************************************************************************
. ***     TOTAL VA PER SECTOR AND STATE
. ***********************************************************************************************************************************************
. * VALUE ADDED
. merge 1:1 sector region state using `va_sh'

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               700  (_merge==3)
    -----------------------------------------

. asser _m==3

. drop _m

. keep if sector<=12
(100 observations deleted)

. * IMPORT EXPOSURE (adh)
. merge m:1 sector using ${instrument}
(note: variable sector was int, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               600  (_merge==3)
    -----------------------------------------

. asser _m==3

. drop _m

. ***
. *** NEW VARIABLES
. ***
. gen VA_ij=va_sh*Y

. bys region: egen VA_i=total(VA_ij)

. bys region: egen Y_i=total(Y)

. gen weight_VA=VA_ij/VA_i

. *tot sales per sector
. bys sector: egen Y_tot_j=total(Y)

. preserve

. collapse Y_tot_j , by(sector)

. rename Y_tot Y_tot_US_s

. tempfile Y_US_`j'

. save `Y_US_`j'', replace
(note: file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000031.tmp not found)
file C:\Users\JOSEPA~1\AppData\Local\Temp\ST_00000031.tmp saved

. restore

. ***********************************************************************************************************************************************
. ***     EXPOSURES
. ***********************************************************************************************************************************************
. * ADH EXPOSURE (before summing across sectors)
. gen ADH_EXP= weight_VA* delta_M_i/Y_tot_j

. * ADH EXPOSURE (OTHERS)
. gen ADH_EXP_predicted= weight_VA* hat_delta_M_i/Y_tot_j

. gen ADH_EXP_others= weight_VA* delta_M_others/Y_tot_j

. 
. collapse (sum) ADH_EXP*  , by(region) 

. 
. reg ADH_EXP ADH_EXP_others, r

Linear regression                                      Number of obs =      50
                                                       F(  1,    48) =12105.77
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.9943
                                                       Root MSE      =   .0017

--------------------------------------------------------------------------------
               |               Robust
       ADH_EXP |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
ADH_EXP_others |   1.472989   .0133876   110.03   0.000     1.446071    1.499906
         _cons |  -.0053573   .0006218    -8.62   0.000    -.0066074   -.0041072
--------------------------------------------------------------------------------

. predict ADH_EXP_predicted_adh, xb

. save $exposures, replace
file 2-Analysis-Codes\0-Processed-Data\exposures.dta saved

. log close
      name:  <unnamed>
       log:  C:\Users\Jose Pablo\Dropbox\NK trade\JP\Data_Construction\2-Analysis-Codes\1-Log-Files\1-exposures.log
  log type:  text
 closed on:  20 Mar 2020, 18:52:27
------------------------------------------------------------------------------------------------------------------------------------------------------
